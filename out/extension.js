"use strict";var at=Object.create;var Y=Object.defineProperty;var ct=Object.getOwnPropertyDescriptor;var dt=Object.getOwnPropertyNames;var lt=Object.getPrototypeOf,ut=Object.prototype.hasOwnProperty;var be=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),ht=(n,e)=>{for(var t in e)Y(n,t,{get:e[t],enumerable:!0})},Te=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of dt(e))!ut.call(n,r)&&r!==t&&Y(n,r,{get:()=>e[r],enumerable:!(s=ct(e,r))||s.enumerable});return n};var T=(n,e,t)=>(t=n!=null?at(lt(n)):{},Te(e||!n||!n.__esModule?Y(t,"default",{value:n,enumerable:!0}):t,n)),pt=n=>Te(Y({},"__esModule",{value:!0}),n);var Ne=be((nr,je)=>{"use strict";je.exports=We;function We(n,e,t){n instanceof RegExp&&(n=Fe(n,t)),e instanceof RegExp&&(e=Fe(e,t));var s=Oe(n,e,t);return s&&{start:s[0],end:s[1],pre:t.slice(0,s[0]),body:t.slice(s[0]+n.length,s[1]),post:t.slice(s[1]+e.length)}}function Fe(n,e){var t=e.match(n);return t?t[0]:null}We.range=Oe;function Oe(n,e,t){var s,r,i,o,a,c=t.indexOf(n),d=t.indexOf(e,c+1),u=c;if(c>=0&&d>0){if(n===e)return[c,d];for(s=[],i=t.length;u>=0&&!a;)u==c?(s.push(u),c=t.indexOf(n,u+1)):s.length==1?a=[s.pop(),d]:(r=s.pop(),r<i&&(i=r,o=d),d=t.indexOf(e,u+1)),u=c<d&&c>=0?c:d;s.length&&(a=[i,o])}return a}});var Ve=be((or,Je)=>{var ze=Ne();Je.exports=vt;var _e="\0SLASH"+Math.random()+"\0",Ge="\0OPEN"+Math.random()+"\0",ve="\0CLOSE"+Math.random()+"\0",Be="\0COMMA"+Math.random()+"\0",He="\0PERIOD"+Math.random()+"\0";function me(n){return parseInt(n,10)==n?parseInt(n,10):n.charCodeAt(0)}function gt(n){return n.split("\\\\").join(_e).split("\\{").join(Ge).split("\\}").join(ve).split("\\,").join(Be).split("\\.").join(He)}function mt(n){return n.split(_e).join("\\").split(Ge).join("{").split(ve).join("}").split(Be).join(",").split(He).join(".")}function Ue(n){if(!n)return[""];var e=[],t=ze("{","}",n);if(!t)return n.split(",");var s=t.pre,r=t.body,i=t.post,o=s.split(",");o[o.length-1]+="{"+r+"}";var a=Ue(i);return i.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),e.push.apply(e,o),e}function vt(n){return n?(n.substr(0,2)==="{}"&&(n="\\{\\}"+n.substr(2)),q(gt(n),!0).map(mt)):[]}function wt(n){return"{"+n+"}"}function yt(n){return/^-?0\d/.test(n)}function Dt(n,e){return n<=e}function St(n,e){return n>=e}function q(n,e){var t=[],s=ze("{","}",n);if(!s)return[n];var r=s.pre,i=s.post.length?q(s.post,!1):[""];if(/\$$/.test(s.pre))for(var o=0;o<i.length;o++){var a=r+"{"+s.body+"}"+i[o];t.push(a)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(s.body),d=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(s.body),u=c||d,g=s.body.indexOf(",")>=0;if(!u&&!g)return s.post.match(/,(?!,).*\}/)?(n=s.pre+"{"+s.body+ve+s.post,q(n)):[n];var l;if(u)l=s.body.split(/\.\./);else if(l=Ue(s.body),l.length===1&&(l=q(l[0],!1).map(wt),l.length===1))return i.map(function(ot){return s.pre+l[0]+ot});var h;if(u){var m=me(l[0]),p=me(l[1]),w=Math.max(l[0].length,l[1].length),y=l.length==3?Math.abs(me(l[2])):1,F=Dt,D=p<m;D&&(y*=-1,F=St);var I=l.some(yt);h=[];for(var $=m;F($,p);$+=y){var b;if(d)b=String.fromCharCode($),b==="\\"&&(b="");else if(b=String($),I){var Ce=w-b.length;if(Ce>0){var xe=new Array(Ce+1).join("0");$<0?b="-"+xe+b.slice(1):b=xe+b}}h.push(b)}}else{h=[];for(var _=0;_<l.length;_++)h.push.apply(h,q(l[_],!1))}for(var _=0;_<h.length;_++)for(var o=0;o<i.length;o++){var a=r+h[_]+i[o];(!e||u||a)&&t.push(a)}}return t}});var ps={};ht(ps,{activate:()=>os,deactivate:()=>us});module.exports=pt(ps);var f=T(require("vscode"));var J=T(require("vscode"));var j=T(require("vscode"));var Me=T(require("crypto"));function W(n){return Me.createHash("md5").update(n).digest("hex")}function ke(n,e){return`${W(n)}-${e}`}function Ee(n){let e=/\b[a-zA-Z_][a-zA-Z0-9_]*\b/g,t=n.match(e)||[],s=new Set(["function","const","let","var","class","interface","type","return","if","else","for","while","do","switch","case","break","continue","try","catch","finally","throw","import","export","from","default","async","await","new","this","super","extends","implements","static","public","private","protected","readonly","abstract","true","false","null","undefined","void","never","def","self","cls","lambda","pass","raise","with","as","func","struct","impl","trait","pub","mut","fn","mod","package","main","fmt","println","print"]);return t.filter(r=>!s.has(r.toLowerCase()))}function Z(n){return n.replace(/\s+/g," ").trim()}function Re(n,e){let t=n.length,s=e.length,r=Array(t+1).fill(null).map(()=>Array(s+1).fill(0));for(let i=0;i<=t;i++)r[i][0]=i;for(let i=0;i<=s;i++)r[0][i]=i;for(let i=1;i<=t;i++)for(let o=1;o<=s;o++)n[i-1]===e[o-1]?r[i][o]=r[i-1][o-1]:r[i][o]=1+Math.min(r[i-1][o],r[i][o-1],r[i-1][o-1]);return r[t][s]}function ge(n,e){if(e.length===0)return null;let t=e[0],s=Re(n,t);for(let r=1;r<e.length;r++){let i=Re(n,e[r]);i<s&&(s=i,t=e[r])}return{match:t,distance:s}}function Ie(n,e){let t=null;return(...s)=>{t&&clearTimeout(t),t=setTimeout(()=>n(...s),e)}}var B=class{parseDocumentation(e,t){switch(t){case"jsdoc":case"javadoc":return this.parseJSDocStyle(e);case"pydoc":return this.parsePyDocStyle(e);case"godoc":return this.parseGoDocStyle(e);case"rustdoc":return this.parseRustDocStyle(e);default:return this.parseGenericComment(e)}}parseJSDocStyle(e){let t={description:"",params:[],tags:[]},r=e.replace(/^\/\*\*?/gm,"").replace(/\*\/$/gm,"").replace(/^\s*\*\s?/gm,"").trim().split(`
`),i=[];for(let o of r){let a=o.trim(),c=a.match(/@param\s+(?:\{([^}]*)\}\s+)?(\w+)\s*(.*)/);if(c){t.params.push({name:c[2],type:c[1],description:c[3]||"",isOptional:c[1]?.includes("=")||!1});continue}let d=a.match(/@returns?\s+(?:\{([^}]*)\}\s*)?(.*)/);if(d){t.returns={type:d[1],description:d[2]||""};continue}let u=a.match(/@(?:throws|exception)\s+(?:\{([^}]*)\}\s*)?(.*)/);if(u){t.throws||(t.throws=[]),t.throws.push({type:u[1],description:u[2]||""});continue}let g=a.match(/@deprecated\s*(.*)/);if(g){t.deprecated=g[1]||"Deprecated";continue}let l=a.match(/@since\s+(.*)/);if(l){t.since=l[1];continue}let h=a.match(/@example\s*(.*)/);if(h){t.examples||(t.examples=[]),t.examples.push(h[1]||"");continue}let m=a.match(/@(\w+)\s*(.*)/);if(m){t.tags.push({name:m[1],value:m[2]||""});continue}a.startsWith("@")||i.push(a)}return t.description=i.join(" ").trim(),t}parsePyDocStyle(e){let t={description:"",params:[],tags:[]},s=e.replace(/^['"`]{3}/gm,"").replace(/['"`]{3}$/gm,"").trim(),r=s.split(/\n\s*\n/);r.length>0&&(t.description=r[0].trim());let i=/(?:Args|Parameters|Params):\s*\n((?:\s+\w+.*\n?)+)/gi,o=s.match(i);if(o){let g=/^\s+(\w+)(?:\s*\(([^)]+)\))?:\s*(.*)$/gm,l;for(;(l=g.exec(o[0]))!==null;)t.params.push({name:l[1],type:l[2],description:l[3]||"",isOptional:!1})}let a=/Returns:\s*\n?\s*(?:(\w+):\s*)?(.+)/i,c=s.match(a);c&&(t.returns={type:c[1],description:c[2]||""});let d=/Raises:\s*\n((?:\s+\w+.*\n?)+)/gi,u=s.match(d);if(u){t.throws=[];let g=/^\s+(\w+):\s*(.*)$/gm,l;for(;(l=g.exec(u[0]))!==null;)t.throws.push({type:l[1],description:l[2]||""})}return t}parseGoDocStyle(e){let t={description:"",params:[],tags:[]},s=e.replace(/^\/\/\s?/gm,"").trim();t.description=s;let r=s.split(/\s+/);return t}parseRustDocStyle(e){let t={description:"",params:[],tags:[]},r=e.replace(/^\/\/[\/!]\s?/gm,"").trim().split(`
`),i=[];for(let o of r){let a=o.trim();if(a==="# Arguments")continue;let c=a.match(/^\*\s+`(\w+)`\s*-\s*(.*)$/);if(c){t.params.push({name:c[1],description:c[2]||"",isOptional:!1});continue}if(a!=="# Returns"){if(a==="# Examples"){t.examples||(t.examples=[]);continue}i.push(a)}}return t.description=i.join(" ").trim(),t}parseGenericComment(e){return{description:e.replace(/^\/\*+/gm,"").replace(/\*+\/$/gm,"").replace(/^\/\/\s?/gm,"").replace(/^\s*\*\s?/gm,"").replace(/^#\s?/gm,"").trim(),params:[],tags:[]}}createPair(e,t,s,r,i,o,a){return{id:ke(e,t.start.line),filePath:e,docRange:t,docContent:s,docType:r,codeRange:i,codeContent:o,codeSignature:a,driftScore:0,driftReasons:[],lastAnalyzed:new Date,isReviewed:!1}}createBasicSignature(e,t,s){return{name:e,type:t,parameters:[],modifiers:[],hash:W(s)}}};var ee=class extends B{languageId="typescript";fileExtensions=[".ts",".tsx",".js",".jsx",".mjs",".cjs"];async parseDocCodePairs(e){let t=[],r=e.getText().split(`
`),i=0;for(;i<r.length;){if(r[i].trim().startsWith("/**")){let a=i,c=i;for(;c<r.length&&!r[c].includes("*/");)c++;if(c<r.length){let u=r.slice(a,c+1).join(`
`),g=new j.Range(new j.Position(a,0),new j.Position(c,r[c].length)),l=c+1;for(;l<r.length;){let h=r[l].trim();if(h===""||h.startsWith("@"))l++;else break}if(l<r.length){let h=this.findCodeBlock(r,l);if(h){let m=r.slice(l,h.end+1).join(`
`),p=new j.Range(new j.Position(l,0),new j.Position(h.end,r[h.end]?.length||0)),w=this.extractCodeSignature(m,p);t.push(this.createPair(e.uri.fsPath,g,u,"jsdoc",p,m,w)),i=h.end}}}}i++}return t}findCodeBlock(e,t){let s=e[t].trim(),r="function";if(s.includes("class ")?r="class":s.includes("interface ")?r="interface":s.includes("type ")?r="type":s.match(/^(export\s+)?(const|let|var)\s+/)&&(r="variable"),!s.includes("{")&&(s.includes("=>")||s.includes("="))){let a=t;for(;a<e.length-1;){let c=e[a].trim();if(c.endsWith(";")||c.endsWith(",")||!c.endsWith("=>")&&!c.endsWith("(")&&!c.endsWith(","))break;a++}return{end:a,type:r}}let i=0,o=!1;for(let a=t;a<e.length;a++){let c=e[a];for(let d of c)d==="{"?(i++,o=!0):d==="}"&&i--;if(o&&i===0)return{end:a,type:r}}return o?null:{end:t,type:r}}extractCodeSignature(e,t){let s=e.split(`
`)[0].trim(),r="unknown",i="function",o=[],a,c=[];s.includes("export ")&&c.push("export"),s.includes("default ")&&c.push("default"),s.includes("async ")&&c.push("async"),s.includes("static ")&&c.push("static"),s.includes("private ")&&c.push("private"),s.includes("protected ")&&c.push("protected"),s.includes("public ")&&c.push("public"),s.includes("readonly ")&&c.push("readonly");let d=s.match(/(?:function\s+)?(\w+)\s*(?:<[^>]*>)?\s*\(([^)]*)\)(?:\s*:\s*([^{=]+))?/);if(d){r=d[1],i=s.includes("class ")?"class":s.includes("interface ")?"interface":"function";let m=d[2];if(m){let p=this.parseParameters(m);o.push(...p)}d[3]&&(a=d[3].trim())}let u=s.match(/(?:const|let|var)\s+(\w+)(?:\s*:\s*[^=]+)?\s*=\s*(?:async\s+)?\(?([^)]*)\)?\s*(?::\s*([^=]+))?\s*=>/);if(u){r=u[1],i="function";let m=u[2];if(m){let p=this.parseParameters(m);o.push(...p)}u[3]&&(a=u[3].trim())}let g=s.match(/class\s+(\w+)/);g&&(r=g[1],i="class");let l=s.match(/interface\s+(\w+)/);l&&(r=l[1],i="interface");let h=s.match(/type\s+(\w+)/);return h&&(r=h[1],i="type"),{name:r,type:i,parameters:o,returnType:a,modifiers:c,hash:W(e)}}parseParameters(e){let t=[];if(!e.trim())return t;let s=0,r="",i=[];for(let o of e)o==="<"||o==="("||o==="["||o==="{"?(s++,r+=o):o===">"||o===")"||o==="]"||o==="}"?(s--,r+=o):o===","&&s===0?(i.push(r.trim()),r=""):r+=o;r.trim()&&i.push(r.trim());for(let o of i){let a=this.parseParameter(o);a&&t.push(a)}return t}parseParameter(e){let t=e.trim();if(!t)return null;let s=t.startsWith("..."),r=s?t.slice(3):t,i=r.match(/^(\w+)(\?)?(?:\s*:\s*([^=]+))?(?:\s*=\s*(.+))?$/);if(i)return{name:i[1],type:i[3]?.trim(),defaultValue:i[4]?.trim(),isOptional:!!i[2]||!!i[4],isRest:s};let o=r.match(/^(\w+)$/);return o?{name:o[1],isOptional:!1,isRest:s}:null}};var N=T(require("vscode"));var te=class extends B{languageId="python";fileExtensions=[".py",".pyw",".pyi"];async parseDocCodePairs(e){let t=[],r=e.getText().split(`
`),i=0;for(;i<r.length;){let a=r[i].trim();if(a.match(/^(async\s+)?def\s+(\w+)\s*\(|^class\s+(\w+)/)){let d=i,u=a.startsWith("class"),g=i;if(!u){let p=0,w=!1;for(let y=i;y<r.length;y++){let F=r[y];for(let D of F)D==="("?(p++,w=!0):D===")"&&p--;if(w&&p===0){g=y;break}}}let l=g+1;for(;l<r.length&&!r[l-1].trim().endsWith(":");)l++;for(;l<r.length&&r[l].trim()==="";)l++;let h=r[l]?.trim()||"",m=this.getDocstringQuote(h);if(m){let p=l;if(h.endsWith(m)&&h.length>m.length*2)p=l;else for(p=l+1;p<r.length&&!r[p].trim().endsWith(m);)p++;let y=r.slice(l,p+1).join(`
`),F=new N.Range(new N.Position(l,0),new N.Position(p,r[p]?.length||0)),D=this.findBlockEnd(r,d),I=r.slice(d,D+1).join(`
`),$=new N.Range(new N.Position(d,0),new N.Position(D,r[D]?.length||0)),b=this.extractCodeSignature(I,$);t.push(this.createPair(e.uri.fsPath,F,y,"pydoc",$,I,b)),i=D}}i++}return t}getDocstringQuote(e){return e.startsWith('"""')?'"""':e.startsWith("'''")?"'''":e.startsWith('"')?'"':e.startsWith("'")?"'":null}findBlockEnd(e,t){let s=this.getIndentation(e[t]),r=t;for(let i=t+1;i<e.length;i++){let o=e[i],a=o.trim();if(a===""||a.startsWith("#"))continue;if(this.getIndentation(o)<=s&&a!=="")break;r=i}return r}getIndentation(e){let t=0;for(let s of e)if(s===" ")t++;else if(s==="	")t+=4;else break;return t}extractCodeSignature(e,t){let s=e.split(`
`),r=s[0].trim(),i="unknown",o="function",a=[],c,d=[];r.startsWith("async ")&&d.push("async");let u=r.match(/^class\s+(\w+)/);if(u)return i=u[1],o="class",{name:i,type:o,parameters:a,returnType:c,modifiers:d,hash:W(e)};let l=this.extractFullSignature(s).match(/(?:async\s+)?def\s+(\w+)\s*\(([^)]*)\)(?:\s*->\s*([^:]+))?/s);if(l){i=l[1],o="function",i.startsWith("__")&&i.endsWith("__")&&d.push("dunder"),i.startsWith("_")&&!i.startsWith("__")&&d.push("private");let h=l[2];if(h){let m=this.parseParameters(h);a.push(...m)}l[3]&&(c=l[3].trim())}return{name:i,type:o,parameters:a,returnType:c,modifiers:d,hash:W(e)}}extractFullSignature(e){let t="",s=0,r=!1;for(let i of e){t+=i+`
`;for(let o of i)o==="("?(s++,r=!0):o===")"&&s--;if(r&&s===0&&(i.includes("->")||i.includes(":")))break}return t}parseParameters(e){let t=[];if(!e.trim())return t;let s=0,r="",i=[];for(let o of e)o==="["||o==="("||o==="{"?(s++,r+=o):o==="]"||o===")"||o==="}"?(s--,r+=o):o===","&&s===0?(i.push(r.trim()),r=""):r+=o;r.trim()&&i.push(r.trim());for(let o of i){let a=this.parseParameter(o);a&&t.push(a)}return t}parseParameter(e){let t=e.trim();if(!t)return null;let s=t==="self"||t==="cls",r=t.startsWith("*")&&!t.startsWith("**"),i=t.startsWith("**");if(r||i){let c=t.replace(/^\*+/,"").match(/^(\w+)(?:\s*:\s*(.+))?$/);if(c)return{name:c[1],type:c[2]?.trim(),isOptional:!0,isRest:r||i}}let o=t.match(/^(\w+)(?:\s*:\s*([^=]+))?(?:\s*=\s*(.+))?$/);return o?{name:o[1],type:o[2]?.trim(),defaultValue:o[3]?.trim(),isOptional:!!o[3]||s,isRest:!1}:null}};var Le=T(require("vscode")),S=class{static outputChannel;static initialize(e){this.outputChannel=Le.window.createOutputChannel(e)}static log(e){if(this.outputChannel){let t=new Date().toISOString();this.outputChannel.appendLine(`[${t}] ${e}`)}}static error(e,t){if(this.outputChannel){let s=new Date().toISOString();this.outputChannel.appendLine(`[${s}] [ERROR] ${e}`),t&&this.outputChannel.appendLine(t instanceof Error?t.stack||t.message:String(t))}}static dispose(){this.outputChannel&&this.outputChannel.dispose()}};var se=class n{static instance;parsers=new Map;extensionMap=new Map;constructor(){this.registerDefaultParsers()}static getInstance(){return n.instance||(n.instance=new n),n.instance}registerDefaultParsers(){let e=new ee;this.registerParser(e),this.parsers.set("javascript",e),this.parsers.set("javascriptreact",e),this.parsers.set("typescriptreact",e);let t=new te;this.registerParser(t)}registerParser(e){this.parsers.set(e.languageId,e);for(let t of e.fileExtensions)this.extensionMap.set(t,e.languageId)}getParser(e){let t=this.parsers.get(e.languageId);if(!t){let s=this.getFileExtension(e.uri.fsPath),r=this.extensionMap.get(s);r&&(t=this.parsers.get(r))}return t}getParserByLanguageId(e){return this.parsers.get(e)}isLanguageSupported(e){return this.parsers.has(e)}getSupportedLanguages(){return Array.from(this.parsers.keys())}async parseDocument(e){let t=this.getParser(e);if(!t)return[];try{return await t.parseDocCodePairs(e)}catch(s){return S.error(`Error parsing document ${e.uri.fsPath}:`,s),[]}}getFileExtension(e){let t=e.lastIndexOf(".");return t===-1?"":e.slice(t).toLowerCase()}};var re=class{paramMismatchWeight=.4;returnTypeMismatchWeight=.2;signatureChangeWeight=.25;descriptionMismatchWeight=.15;analyzePair(e,t){let s=[],r=t.parseDocumentation(e.docContent,e.docType),i=this.analyzeParameters(r,e.codeSignature);s.push(...i);let o=this.analyzeReturnType(r,e.codeSignature);s.push(...o);let a=this.analyzeDescription(r,e.codeContent,e.codeSignature);s.push(...a);let c=this.calculateDriftScore(s);return{...e,driftScore:c,driftReasons:s,lastAnalyzed:new Date}}analyzeParameters(e,t){let s=[],r=e.params.map(o=>o.name.toLowerCase()),i=t.parameters.filter(o=>!["self","cls"].includes(o.name.toLowerCase())).map(o=>o.name.toLowerCase());for(let o of e.params){let a=o.name.toLowerCase();if(!["self","cls"].includes(a)&&!i.includes(a)){let c=ge(a,i);c&&c.distance<=2?s.push({type:"parameter_renamed",severity:"medium",message:`Parameter '${o.name}' may have been renamed to '${c.match}'`,details:`Documentation mentions '${o.name}' but code has '${c.match}'`}):s.push({type:"parameter_removed",severity:"high",message:`Documented parameter '${o.name}' not found in code`,details:"The documentation describes a parameter that doesn't exist in the current function signature"})}}for(let o of t.parameters){let a=o.name.toLowerCase();["self","cls"].includes(a)||r.includes(a)||o.name.length>1&&s.push({type:"parameter_added",severity:"medium",message:`Parameter '${o.name}' is not documented`,details:`The code has a parameter '${o.name}' that isn't described in the documentation`})}for(let o of e.params){let a=t.parameters.find(c=>c.name.toLowerCase()===o.name.toLowerCase());if(a&&o.type&&a.type){let c=Z(o.type.toLowerCase()),d=Z(a.type.toLowerCase());this.typesMatch(c,d)||s.push({type:"parameter_mismatch",severity:"medium",message:`Type mismatch for parameter '${o.name}'`,details:`Documentation says '${o.type}' but code has '${a.type}'`})}}return s}analyzeReturnType(e,t){let s=[];if(e.returns&&t.returnType){let r=Z(e.returns.type?.toLowerCase()||""),i=Z(t.returnType.toLowerCase());r&&!this.typesMatch(r,i)&&s.push({type:"return_type_mismatch",severity:"medium",message:"Return type mismatch",details:`Documentation says '${e.returns.type}' but code returns '${t.returnType}'`})}return e.returns&&!t.returnType&&e.returns.type&&!["void","none","undefined"].includes(e.returns.type.toLowerCase())&&s.push({type:"return_type_mismatch",severity:"low",message:"Documentation specifies return type but code has none",details:`Documentation mentions returning '${e.returns.type}' but no return type in signature`}),s}analyzeDescription(e,t,s){let r=[],i=new Set(Ee(t).map(a=>a.toLowerCase())),o=this.extractDescriptionReferences(e.description);for(let a of o){let c=a.toLowerCase();if(!(a.length<=2)&&!i.has(c)){let d=ge(c,Array.from(i));d&&d.distance<=2&&d.distance>0&&r.push({type:"description_mismatch",severity:"low",message:`Description references '${a}' which may have been renamed to '${d.match}'`,details:"Consider updating the documentation to use the current name"})}}return r}extractDescriptionReferences(e){let t=[],s=e.match(/`([a-zA-Z_][a-zA-Z0-9_]*)`/g);s&&t.push(...s.map(a=>a.slice(1,-1)));let r=/\b([a-z][a-zA-Z0-9]*[A-Z][a-zA-Z0-9]*)\b/g,i=/\b([a-z][a-z0-9]*_[a-z][a-z0-9_]*)\b/g,o;for(;(o=r.exec(e))!==null;)t.push(o[1]);for(;(o=i.exec(e))!==null;)t.push(o[1]);return[...new Set(t)]}typesMatch(e,t){if(e===t)return!0;let s={string:["str","string"],number:["int","float","number","integer"],boolean:["bool","boolean"],array:["list","array","[]"],object:["dict","object","map","record"],any:["any","object","unknown"],void:["void","none","null","undefined"]};for(let r of Object.values(s))if(r.includes(e)&&r.includes(t))return!0;return!!(e.includes(t)||t.includes(e))}calculateDriftScore(e){if(e.length===0)return 0;let t=0;for(let s of e){let r=0;switch(s.type){case"parameter_mismatch":case"parameter_added":case"parameter_removed":case"parameter_renamed":r=this.paramMismatchWeight;break;case"return_type_mismatch":r=this.returnTypeMismatchWeight;break;case"signature_changed":case"code_content_changed":r=this.signatureChangeWeight;break;case"description_mismatch":r=this.descriptionMismatchWeight;break;default:r=.1}switch(s.severity){case"critical":r*=1.5;break;case"high":r*=1.2;break;case"medium":r*=1;break;case"low":r*=.5;break}t+=r}return Math.min(1,t)}compareSignatures(e,t){let s=[];return e.hash!==t.hash&&s.push({type:"code_content_changed",severity:"medium",message:"Code content has changed since documentation was last reviewed",details:"The implementation may have been updated without reviewing the documentation"}),e.name!==t.name&&s.push({type:"signature_changed",severity:"high",message:`Function renamed from '${e.name}' to '${t.name}'`,details:"The function name has changed"}),e.parameters.length!==t.parameters.length&&s.push({type:"signature_changed",severity:"high",message:"Parameter count has changed",details:`Was ${e.parameters.length} parameters, now ${t.parameters.length}`}),s}};var tt=T(Ve(),1);var Q=n=>{if(typeof n!="string")throw new TypeError("invalid pattern");if(n.length>65536)throw new TypeError("pattern is too long")};var Pt={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},X=n=>n.replace(/[[\]\\-]/g,"\\$&"),Ct=n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Ze=n=>n.join(""),qe=(n,e)=>{let t=e;if(n.charAt(t)!=="[")throw new Error("not in a brace expression");let s=[],r=[],i=t+1,o=!1,a=!1,c=!1,d=!1,u=t,g="";e:for(;i<n.length;){let p=n.charAt(i);if((p==="!"||p==="^")&&i===t+1){d=!0,i++;continue}if(p==="]"&&o&&!c){u=i+1;break}if(o=!0,p==="\\"&&!c){c=!0,i++;continue}if(p==="["&&!c){for(let[w,[y,F,D]]of Object.entries(Pt))if(n.startsWith(w,i)){if(g)return["$.",!1,n.length-t,!0];i+=w.length,D?r.push(y):s.push(y),a=a||F;continue e}}if(c=!1,g){p>g?s.push(X(g)+"-"+X(p)):p===g&&s.push(X(p)),g="",i++;continue}if(n.startsWith("-]",i+1)){s.push(X(p+"-")),i+=2;continue}if(n.startsWith("-",i+1)){g=p,i+=2;continue}s.push(X(p)),i++}if(u<i)return["",!1,0,!1];if(!s.length&&!r.length)return["$.",!1,n.length-t,!0];if(r.length===0&&s.length===1&&/^\\?.$/.test(s[0])&&!d){let p=s[0].length===2?s[0].slice(-1):s[0];return[Ct(p),!1,u-t,!1]}let l="["+(d?"^":"")+Ze(s)+"]",h="["+(d?"":"^")+Ze(r)+"]";return[s.length&&r.length?"("+l+"|"+h+")":s.length?l:h,a,u-t,!0]};var z=(n,{windowsPathsNoEscape:e=!1}={})=>e?n.replace(/\[([^\/\\])\]/g,"$1"):n.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1");var xt=new Set(["!","?","+","*","@"]),Qe=n=>xt.has(n),bt="(?!(?:^|/)\\.\\.?(?:$|/))",ie="(?!\\.)",Tt=new Set(["[","."]),Rt=new Set(["..","."]),Mt=new Set("().*{}+?[]^$\\!"),kt=n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),we="[^/]",Xe=we+"*?",Ke=we+"+?",H=class n{type;#s;#r;#n=!1;#e=[];#t;#o;#c;#a=!1;#i;#d;#u=!1;constructor(e,t,s={}){this.type=e,e&&(this.#r=!0),this.#t=t,this.#s=this.#t?this.#t.#s:this,this.#i=this.#s===this?s:this.#s.#i,this.#c=this.#s===this?[]:this.#s.#c,e==="!"&&!this.#s.#a&&this.#c.push(this),this.#o=this.#t?this.#t.#e.length:0}get hasMagic(){if(this.#r!==void 0)return this.#r;for(let e of this.#e)if(typeof e!="string"&&(e.type||e.hasMagic))return this.#r=!0;return this.#r}toString(){return this.#d!==void 0?this.#d:this.type?this.#d=this.type+"("+this.#e.map(e=>String(e)).join("|")+")":this.#d=this.#e.map(e=>String(e)).join("")}#p(){if(this!==this.#s)throw new Error("should only call on root");if(this.#a)return this;this.toString(),this.#a=!0;let e;for(;e=this.#c.pop();){if(e.type!=="!")continue;let t=e,s=t.#t;for(;s;){for(let r=t.#o+1;!s.type&&r<s.#e.length;r++)for(let i of e.#e){if(typeof i=="string")throw new Error("string part in extglob AST??");i.copyIn(s.#e[r])}t=s,s=t.#t}}return this}push(...e){for(let t of e)if(t!==""){if(typeof t!="string"&&!(t instanceof n&&t.#t===this))throw new Error("invalid part: "+t);this.#e.push(t)}}toJSON(){let e=this.type===null?this.#e.slice().map(t=>typeof t=="string"?t:t.toJSON()):[this.type,...this.#e.map(t=>t.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===this.#s||this.#s.#a&&this.#t?.type==="!")&&e.push({}),e}isStart(){if(this.#s===this)return!0;if(!this.#t?.isStart())return!1;if(this.#o===0)return!0;let e=this.#t;for(let t=0;t<this.#o;t++){let s=e.#e[t];if(!(s instanceof n&&s.type==="!"))return!1}return!0}isEnd(){if(this.#s===this||this.#t?.type==="!")return!0;if(!this.#t?.isEnd())return!1;if(!this.type)return this.#t?.isEnd();let e=this.#t?this.#t.#e.length:0;return this.#o===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){let t=new n(this.type,e);for(let s of this.#e)t.copyIn(s);return t}static#l(e,t,s,r){let i=!1,o=!1,a=-1,c=!1;if(t.type===null){let h=s,m="";for(;h<e.length;){let p=e.charAt(h++);if(i||p==="\\"){i=!i,m+=p;continue}if(o){h===a+1?(p==="^"||p==="!")&&(c=!0):p==="]"&&!(h===a+2&&c)&&(o=!1),m+=p;continue}else if(p==="["){o=!0,a=h,c=!1,m+=p;continue}if(!r.noext&&Qe(p)&&e.charAt(h)==="("){t.push(m),m="";let w=new n(p,t);h=n.#l(e,w,h,r),t.push(w);continue}m+=p}return t.push(m),h}let d=s+1,u=new n(null,t),g=[],l="";for(;d<e.length;){let h=e.charAt(d++);if(i||h==="\\"){i=!i,l+=h;continue}if(o){d===a+1?(h==="^"||h==="!")&&(c=!0):h==="]"&&!(d===a+2&&c)&&(o=!1),l+=h;continue}else if(h==="["){o=!0,a=d,c=!1,l+=h;continue}if(Qe(h)&&e.charAt(d)==="("){u.push(l),l="";let m=new n(h,u);u.push(m),d=n.#l(e,m,d,r);continue}if(h==="|"){u.push(l),l="",g.push(u),u=new n(null,t);continue}if(h===")")return l===""&&t.#e.length===0&&(t.#u=!0),u.push(l),l="",t.push(...g,u),d;l+=h}return t.type=null,t.#r=void 0,t.#e=[e.substring(s-1)],d}static fromGlob(e,t={}){let s=new n(null,void 0,t);return n.#l(e,s,0,t),s}toMMPattern(){if(this!==this.#s)return this.#s.toMMPattern();let e=this.toString(),[t,s,r,i]=this.toRegExpSource();if(!(r||this.#r||this.#i.nocase&&!this.#i.nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return s;let a=(this.#i.nocase?"i":"")+(i?"u":"");return Object.assign(new RegExp(`^${t}$`,a),{_src:t,_glob:e})}get options(){return this.#i}toRegExpSource(e){let t=e??!!this.#i.dot;if(this.#s===this&&this.#p(),!this.type){let c=this.isStart()&&this.isEnd(),d=this.#e.map(h=>{let[m,p,w,y]=typeof h=="string"?n.#f(h,this.#r,c):h.toRegExpSource(e);return this.#r=this.#r||w,this.#n=this.#n||y,m}).join(""),u="";if(this.isStart()&&typeof this.#e[0]=="string"&&!(this.#e.length===1&&Rt.has(this.#e[0]))){let m=Tt,p=t&&m.has(d.charAt(0))||d.startsWith("\\.")&&m.has(d.charAt(2))||d.startsWith("\\.\\.")&&m.has(d.charAt(4)),w=!t&&!e&&m.has(d.charAt(0));u=p?bt:w?ie:""}let g="";return this.isEnd()&&this.#s.#a&&this.#t?.type==="!"&&(g="(?:$|\\/)"),[u+d+g,z(d),this.#r=!!this.#r,this.#n]}let s=this.type==="*"||this.type==="+",r=this.type==="!"?"(?:(?!(?:":"(?:",i=this.#h(t);if(this.isStart()&&this.isEnd()&&!i&&this.type!=="!"){let c=this.toString();return this.#e=[c],this.type=null,this.#r=void 0,[c,z(this.toString()),!1,!1]}let o=!s||e||t||!ie?"":this.#h(!0);o===i&&(o=""),o&&(i=`(?:${i})(?:${o})*?`);let a="";if(this.type==="!"&&this.#u)a=(this.isStart()&&!t?ie:"")+Ke;else{let c=this.type==="!"?"))"+(this.isStart()&&!t&&!e?ie:"")+Xe+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&o?")":this.type==="*"&&o?")?":`)${this.type}`;a=r+i+c}return[a,z(i),this.#r=!!this.#r,this.#n]}#h(e){return this.#e.map(t=>{if(typeof t=="string")throw new Error("string type in extglob ast??");let[s,r,i,o]=t.toRegExpSource(e);return this.#n=this.#n||o,s}).filter(t=>!(this.isStart()&&this.isEnd())||!!t).join("|")}static#f(e,t,s=!1){let r=!1,i="",o=!1;for(let a=0;a<e.length;a++){let c=e.charAt(a);if(r){r=!1,i+=(Mt.has(c)?"\\":"")+c;continue}if(c==="\\"){a===e.length-1?i+="\\\\":r=!0;continue}if(c==="["){let[d,u,g,l]=qe(e,a);if(g){i+=d,o=o||u,a+=g-1,t=t||l;continue}}if(c==="*"){s&&e==="*"?i+=Ke:i+=Xe,t=!0;continue}if(c==="?"){i+=we,t=!0;continue}i+=kt(c)}return[i,z(e),!!t,o]}};var ye=(n,{windowsPathsNoEscape:e=!1}={})=>e?n.replace(/[?*()[\]]/g,"[$&]"):n.replace(/[?*()[\]\\]/g,"\\$&");var P=(n,e,t={})=>(Q(e),!t.nocomment&&e.charAt(0)==="#"?!1:new U(e,t).match(n)),Et=/^\*+([^+@!?\*\[\(]*)$/,It=n=>e=>!e.startsWith(".")&&e.endsWith(n),$t=n=>e=>e.endsWith(n),Lt=n=>(n=n.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(n)),At=n=>(n=n.toLowerCase(),e=>e.toLowerCase().endsWith(n)),Ft=/^\*+\.\*+$/,Wt=n=>!n.startsWith(".")&&n.includes("."),Ot=n=>n!=="."&&n!==".."&&n.includes("."),jt=/^\.\*+$/,Nt=n=>n!=="."&&n!==".."&&n.startsWith("."),zt=/^\*+$/,_t=n=>n.length!==0&&!n.startsWith("."),Gt=n=>n.length!==0&&n!=="."&&n!=="..",Bt=/^\?+([^+@!?\*\[\(]*)?$/,Ht=([n,e=""])=>{let t=st([n]);return e?(e=e.toLowerCase(),s=>t(s)&&s.toLowerCase().endsWith(e)):t},Ut=([n,e=""])=>{let t=rt([n]);return e?(e=e.toLowerCase(),s=>t(s)&&s.toLowerCase().endsWith(e)):t},Jt=([n,e=""])=>{let t=rt([n]);return e?s=>t(s)&&s.endsWith(e):t},Vt=([n,e=""])=>{let t=st([n]);return e?s=>t(s)&&s.endsWith(e):t},st=([n])=>{let e=n.length;return t=>t.length===e&&!t.startsWith(".")},rt=([n])=>{let e=n.length;return t=>t.length===e&&t!=="."&&t!==".."},it=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",Ye={win32:{sep:"\\"},posix:{sep:"/"}},Zt=it==="win32"?Ye.win32.sep:Ye.posix.sep;P.sep=Zt;var E=Symbol("globstar **");P.GLOBSTAR=E;var qt="[^/]",Qt=qt+"*?",Xt="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Kt="(?:(?!(?:\\/|^)\\.).)*?",Yt=(n,e={})=>t=>P(t,n,e);P.filter=Yt;var k=(n,e={})=>Object.assign({},n,e),es=n=>{if(!n||typeof n!="object"||!Object.keys(n).length)return P;let e=P;return Object.assign((s,r,i={})=>e(s,r,k(n,i)),{Minimatch:class extends e.Minimatch{constructor(r,i={}){super(r,k(n,i))}static defaults(r){return e.defaults(k(n,r)).Minimatch}},AST:class extends e.AST{constructor(r,i,o={}){super(r,i,k(n,o))}static fromGlob(r,i={}){return e.AST.fromGlob(r,k(n,i))}},unescape:(s,r={})=>e.unescape(s,k(n,r)),escape:(s,r={})=>e.escape(s,k(n,r)),filter:(s,r={})=>e.filter(s,k(n,r)),defaults:s=>e.defaults(k(n,s)),makeRe:(s,r={})=>e.makeRe(s,k(n,r)),braceExpand:(s,r={})=>e.braceExpand(s,k(n,r)),match:(s,r,i={})=>e.match(s,r,k(n,i)),sep:e.sep,GLOBSTAR:E})};P.defaults=es;var nt=(n,e={})=>(Q(n),e.nobrace||!/\{(?:(?!\{).)*\}/.test(n)?[n]:(0,tt.default)(n));P.braceExpand=nt;var ts=(n,e={})=>new U(n,e).makeRe();P.makeRe=ts;var ss=(n,e,t={})=>{let s=new U(e,t);return n=n.filter(r=>s.match(r)),s.options.nonull&&!n.length&&n.push(e),n};P.match=ss;var et=/[?*]|[+@!]\(.*?\)|\[|\]/,rs=n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),U=class{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(e,t={}){Q(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||it,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=t.windowsNoMagicRoot!==void 0?t.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(let e of this.set)for(let t of e)if(typeof t!="string")return!0;return!1}debug(...e){}make(){let e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=(...i)=>console.error(...i)),this.debug(this.pattern,this.globSet);let s=this.globSet.map(i=>this.slashSplit(i));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let r=this.globParts.map((i,o,a)=>{if(this.isWindows&&this.windowsNoMagicRoot){let c=i[0]===""&&i[1]===""&&(i[2]==="?"||!et.test(i[2]))&&!et.test(i[3]),d=/^[a-z]:/i.test(i[0]);if(c)return[...i.slice(0,4),...i.slice(4).map(u=>this.parse(u))];if(d)return[i[0],...i.slice(1).map(u=>this.parse(u))]}return i.map(c=>this.parse(c))});if(this.debug(this.pattern,r),this.set=r.filter(i=>i.indexOf(!1)===-1),this.isWindows)for(let i=0;i<this.set.length;i++){let o=this.set[i];o[0]===""&&o[1]===""&&this.globParts[i][2]==="?"&&typeof o[3]=="string"&&/^[a-z]:$/i.test(o[3])&&(o[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let s=0;s<e.length;s++)for(let r=0;r<e[s].length;r++)e[s][r]==="**"&&(e[s][r]="*");let{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):t>=1?e=this.levelOneOptimize(e):e=this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(t=>{let s=-1;for(;(s=t.indexOf("**",s+1))!==-1;){let r=s;for(;t[r+1]==="**";)r++;r!==s&&t.splice(s,r-s)}return t})}levelOneOptimize(e){return e.map(t=>(t=t.reduce((s,r)=>{let i=s[s.length-1];return r==="**"&&i==="**"?s:r===".."&&i&&i!==".."&&i!=="."&&i!=="**"?(s.pop(),s):(s.push(r),s)},[]),t.length===0?[""]:t))}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let r=1;r<e.length-1;r++){let i=e[r];r===1&&i===""&&e[0]===""||(i==="."||i==="")&&(t=!0,e.splice(r,1),r--)}e[0]==="."&&e.length===2&&(e[1]==="."||e[1]==="")&&(t=!0,e.pop())}let s=0;for(;(s=e.indexOf("..",s+1))!==-1;){let r=e[s-1];r&&r!=="."&&r!==".."&&r!=="**"&&(t=!0,e.splice(s-1,2),s-=2)}}while(t);return e.length===0?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let s of e){let r=-1;for(;(r=s.indexOf("**",r+1))!==-1;){let o=r;for(;s[o+1]==="**";)o++;o>r&&s.splice(r+1,o-r);let a=s[r+1],c=s[r+2],d=s[r+3];if(a!==".."||!c||c==="."||c===".."||!d||d==="."||d==="..")continue;t=!0,s.splice(r,1);let u=s.slice(0);u[r]="**",e.push(u),r--}if(!this.preserveMultipleSlashes){for(let o=1;o<s.length-1;o++){let a=s[o];o===1&&a===""&&s[0]===""||(a==="."||a==="")&&(t=!0,s.splice(o,1),o--)}s[0]==="."&&s.length===2&&(s[1]==="."||s[1]==="")&&(t=!0,s.pop())}let i=0;for(;(i=s.indexOf("..",i+1))!==-1;){let o=s[i-1];if(o&&o!=="."&&o!==".."&&o!=="**"){t=!0;let c=i===1&&s[i+1]==="**"?["."]:[];s.splice(i-1,2,...c),s.length===0&&s.push(""),i-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let s=t+1;s<e.length;s++){let r=this.partsMatch(e[t],e[s],!this.preserveMultipleSlashes);if(r){e[t]=[],e[s]=r;break}}return e.filter(t=>t.length)}partsMatch(e,t,s=!1){let r=0,i=0,o=[],a="";for(;r<e.length&&i<t.length;)if(e[r]===t[i])o.push(a==="b"?t[i]:e[r]),r++,i++;else if(s&&e[r]==="**"&&t[i]===e[r+1])o.push(e[r]),r++;else if(s&&t[i]==="**"&&e[r]===t[i+1])o.push(t[i]),i++;else if(e[r]==="*"&&t[i]&&(this.options.dot||!t[i].startsWith("."))&&t[i]!=="**"){if(a==="b")return!1;a="a",o.push(e[r]),r++,i++}else if(t[i]==="*"&&e[r]&&(this.options.dot||!e[r].startsWith("."))&&e[r]!=="**"){if(a==="a")return!1;a="b",o.push(t[i]),r++,i++}else return!1;return e.length===t.length&&o}parseNegate(){if(this.nonegate)return;let e=this.pattern,t=!1,s=0;for(let r=0;r<e.length&&e.charAt(r)==="!";r++)t=!t,s++;s&&(this.pattern=e.slice(s)),this.negate=t}matchOne(e,t,s=!1){let r=this.options;if(this.isWindows){let p=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),w=!p&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),y=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),F=!y&&t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3]),D=w?3:p?0:void 0,I=F?3:y?0:void 0;if(typeof D=="number"&&typeof I=="number"){let[$,b]=[e[D],t[I]];$.toLowerCase()===b.toLowerCase()&&(t[I]=$,I>D?t=t.slice(I):D>I&&(e=e.slice(D)))}}let{optimizationLevel:i=1}=this.options;i>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var o=0,a=0,c=e.length,d=t.length;o<c&&a<d;o++,a++){this.debug("matchOne loop");var u=t[a],g=e[o];if(this.debug(t,u,g),u===!1)return!1;if(u===E){this.debug("GLOBSTAR",[t,u,g]);var l=o,h=a+1;if(h===d){for(this.debug("** at the end");o<c;o++)if(e[o]==="."||e[o]===".."||!r.dot&&e[o].charAt(0)===".")return!1;return!0}for(;l<c;){var m=e[l];if(this.debug(`
globstar while`,e,l,t,h,m),this.matchOne(e.slice(l),t.slice(h),s))return this.debug("globstar found match!",l,c,m),!0;if(m==="."||m===".."||!r.dot&&m.charAt(0)==="."){this.debug("dot detected!",e,l,t,h);break}this.debug("globstar swallow a segment, and continue"),l++}return!!(s&&(this.debug(`
>>> no match, partial?`,e,l,t,h),l===c))}let p;if(typeof u=="string"?(p=g===u,this.debug("string match",u,g,p)):(p=u.test(g),this.debug("pattern match",u,g,p)),!p)return!1}if(o===c&&a===d)return!0;if(o===c)return s;if(a===d)return o===c-1&&e[o]==="";throw new Error("wtf?")}braceExpand(){return nt(this.pattern,this.options)}parse(e){Q(e);let t=this.options;if(e==="**")return E;if(e==="")return"";let s,r=null;(s=e.match(zt))?r=t.dot?Gt:_t:(s=e.match(Et))?r=(t.nocase?t.dot?At:Lt:t.dot?$t:It)(s[1]):(s=e.match(Bt))?r=(t.nocase?t.dot?Ut:Ht:t.dot?Jt:Vt)(s):(s=e.match(Ft))?r=t.dot?Ot:Wt:(s=e.match(jt))&&(r=Nt);let i=H.fromGlob(e,this.options).toMMPattern();return r&&typeof i=="object"&&Reflect.defineProperty(i,"test",{value:r}),i}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let e=this.set;if(!e.length)return this.regexp=!1,this.regexp;let t=this.options,s=t.noglobstar?Qt:t.dot?Xt:Kt,r=new Set(t.nocase?["i"]:[]),i=e.map(c=>{let d=c.map(u=>{if(u instanceof RegExp)for(let g of u.flags.split(""))r.add(g);return typeof u=="string"?rs(u):u===E?E:u._src});return d.forEach((u,g)=>{let l=d[g+1],h=d[g-1];u!==E||h===E||(h===void 0?l!==void 0&&l!==E?d[g+1]="(?:\\/|"+s+"\\/)?"+l:d[g]=s:l===void 0?d[g-1]=h+"(?:\\/|"+s+")?":l!==E&&(d[g-1]=h+"(?:\\/|\\/"+s+"\\/)"+l,d[g+1]=E))}),d.filter(u=>u!==E).join("/")}).join("|"),[o,a]=e.length>1?["(?:",")"]:["",""];i="^"+o+i+a+"$",this.negate&&(i="^(?!"+i+").+$");try{this.regexp=new RegExp(i,[...r].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;let s=this.options;this.isWindows&&(e=e.split("\\").join("/"));let r=this.slashSplit(e);this.debug(this.pattern,"split",r);let i=this.set;this.debug(this.pattern,"set",i);let o=r[r.length-1];if(!o)for(let a=r.length-2;!o&&a>=0;a--)o=r[a];for(let a=0;a<i.length;a++){let c=i[a],d=r;if(s.matchBase&&c.length===1&&(d=[o]),this.matchOne(d,c,t))return s.flipNegate?!0:!this.negate}return s.flipNegate?!1:this.negate}static defaults(e){return P.defaults(e).Minimatch}};P.AST=H;P.Minimatch=U;P.escape=ye;P.unescape=z;var ne=class{parserRegistry;analyzer;config;scanResults=new Map;constructor(e){this.parserRegistry=se.getInstance(),this.analyzer=new re,this.config=e}updateConfig(e){this.config=e}async scanWorkspace(e){let t=J.workspace.workspaceFolders;if(!t)return[];let s=[];for(let r of t){e?.report({message:`Scanning ${r.name}...`});let i=await this.findSupportedFiles(r.uri),o=i.length,a=0;for(let c of i){try{let d=await J.workspace.openTextDocument(c),u=await this.scanDocument(d);s.push(...u),this.scanResults.set(c.fsPath,u)}catch(d){S.error(`Error scanning ${c.fsPath}:`,d)}a++,e?.report({message:`Scanning ${r.name}... (${a}/${o})`,increment:1/o*100})}}return s}async scanDocument(e){if(this.shouldExclude(e.uri.fsPath))return[];if(!this.config.supportedLanguages.includes(e.languageId))return[];let t=this.parserRegistry.getParser(e);if(!t)return[];let r=(await this.parserRegistry.parseDocument(e)).map(i=>this.analyzer.analyzePair(i,t));return this.scanResults.set(e.uri.fsPath,r),r}getResultsForFile(e){return this.scanResults.get(e)}getAllResults(){let e=[];for(let t of this.scanResults.values())e.push(...t);return e}clearResults(){this.scanResults.clear()}clearResultsForFile(e){this.scanResults.delete(e)}async findSupportedFiles(e){let s=`**/*{${this.getSupportedExtensions().join(",")}}`;return await J.workspace.findFiles(new J.RelativePattern(e,s),this.getExcludePattern())}getSupportedExtensions(){let e=[];for(let t of this.config.supportedLanguages){let s=this.parserRegistry.getParserByLanguageId(t);s&&e.push(...s.fileExtensions)}return[...new Set(e)]}getExcludePattern(){return`{${this.config.excludePatterns.join(",")}}`}shouldExclude(e){for(let t of this.config.excludePatterns)if(P(e,t,{dot:!0}))return!0;return!1}getAnalyzer(){return this.analyzer}};var v=T(require("vscode"));var Se=T(require("path")),K=class n extends v.TreeItem{constructor(t,s){let r=n.getSeverityFromScore(t.driftScore),i=n.getSeverityIcon(r);super(`${i} ${t.codeSignature.name}`,v.TreeItemCollapsibleState.Collapsed);this.pair=t;this.workspaceFolder=s;let o=Se.relative(s,t.filePath);this.description=`${o}:${t.docRange.start.line+1}`,this.tooltip=new v.MarkdownString,this.tooltip.appendMarkdown(`**${t.codeSignature.name}**

`),this.tooltip.appendMarkdown(`Drift Score: ${Math.round(t.driftScore*100)}%

`),this.tooltip.appendMarkdown(`File: ${o}

`),this.tooltip.appendMarkdown(`Line: ${t.docRange.start.line+1}`),this.iconPath=new v.ThemeIcon(this.getThemeIconName(r),this.getIconColor(r)),this.contextValue="driftItem",this.command={command:"vscode.open",title:"Open",arguments:[v.Uri.file(t.filePath),{selection:new v.Range(t.docRange.start,t.docRange.end)}]}}getThemeIconName(t){switch(t){case"critical":return"error";case"high":return"warning";case"medium":return"info";case"low":return"circle-outline";default:return"question"}}getIconColor(t){switch(t){case"critical":return new v.ThemeColor("errorForeground");case"high":return new v.ThemeColor("editorWarning.foreground");case"medium":return new v.ThemeColor("editorInfo.foreground");case"low":return new v.ThemeColor("foreground");default:return new v.ThemeColor("foreground")}}static getSeverityFromScore(t){return t>=.8?"critical":t>=.6?"high":t>=.4?"medium":"low"}static getSeverityIcon(t){switch(t){case"critical":return"\u{1F534}";case"high":return"\u{1F7E0}";case"medium":return"\u{1F7E1}";case"low":return"\u26AA";default:return"\u2753"}}},De=class extends v.TreeItem{constructor(t,s,r){super(t,v.TreeItemCollapsibleState.None);this.message=t;this.details=s;this.severity=r;this.description=s,this.iconPath=new v.ThemeIcon(this.getThemeIconName(r),this.getIconColor(r))}getThemeIconName(t){switch(t){case"critical":return"circle-filled";case"high":return"circle-filled";case"medium":return"circle-outline";case"low":return"dash";default:return"dash"}}getIconColor(t){switch(t){case"critical":return new v.ThemeColor("errorForeground");case"high":return new v.ThemeColor("editorWarning.foreground");case"medium":return new v.ThemeColor("editorInfo.foreground");case"low":return new v.ThemeColor("foreground");default:return new v.ThemeColor("foreground")}}},oe=class extends v.TreeItem{constructor(t,s,r){let i=Se.relative(r,t),o=Math.max(...s.map(a=>a.driftScore));super(i,v.TreeItemCollapsibleState.Expanded);this.filePath=t;this.pairs=s;this.workspaceFolder=r;this.description=`${s.length} issue${s.length>1?"s":""}`,this.iconPath=v.ThemeIcon.File,this.resourceUri=v.Uri.file(t),this.contextValue="fileGroup"}},ae=class{_onDidChangeTreeData=new v.EventEmitter;onDidChangeTreeData=this._onDidChangeTreeData.event;pairs=[];groupByFile=!0;workspaceFolder="";constructor(){let e=v.workspace.workspaceFolders;e&&e.length>0&&(this.workspaceFolder=e[0].uri.fsPath)}updatePairs(e){this.pairs=e.filter(t=>!t.isReviewed&&t.driftScore>0).sort((t,s)=>s.driftScore-t.driftScore),this._onDidChangeTreeData.fire()}markAsReviewed(e){let t=this.pairs.find(s=>s.id===e);t&&(t.isReviewed=!0,t.reviewedAt=new Date,this._onDidChangeTreeData.fire())}refresh(){this._onDidChangeTreeData.fire()}toggleGroupByFile(){this.groupByFile=!this.groupByFile,this._onDidChangeTreeData.fire()}getTreeItem(e){return e}getChildren(e){return e?e instanceof oe?e.pairs.map(t=>new K(t,this.workspaceFolder)):e instanceof K?e.pair.driftReasons.map(t=>new De(t.message,t.details,t.severity)):[]:this.pairs.length===0?[this.createEmptyStateItem()]:this.groupByFile?this.getFileGroups():this.pairs.map(t=>new K(t,this.workspaceFolder))}getFileGroups(){let e=new Map;for(let t of this.pairs){let s=e.get(t.filePath)||[];s.push(t),e.set(t.filePath,s)}return Array.from(e.entries()).map(([t,s])=>new oe(t,s,this.workspaceFolder)).sort((t,s)=>{let r=Math.max(...t.pairs.map(o=>o.driftScore));return Math.max(...s.pairs.map(o=>o.driftScore))-r})}createEmptyStateItem(){let e=new v.TreeItem("No documentation drift detected \u2713");return e.iconPath=new v.ThemeIcon("check",new v.ThemeColor("testing.iconPassed")),e.description='Run "Drift: Scan Workspace" to check',e}getPairById(e){return this.pairs.find(t=>t.id===e)}getAllPairs(){return this.pairs}getStatistics(){return{total:this.pairs.length,critical:this.pairs.filter(e=>e.driftScore>=.8).length,high:this.pairs.filter(e=>e.driftScore>=.6&&e.driftScore<.8).length,medium:this.pairs.filter(e=>e.driftScore>=.4&&e.driftScore<.6).length,low:this.pairs.filter(e=>e.driftScore<.4).length}}};var x=T(require("vscode"));var ce=class{gutterDecorationType;inlineDecorationTypes;activeDecorations=new Map;constructor(){this.gutterDecorationType=x.window.createTextEditorDecorationType({gutterIconPath:this.getIconPath("warning"),gutterIconSize:"contain"}),this.inlineDecorationTypes=new Map([["critical",x.window.createTextEditorDecorationType({backgroundColor:"rgba(255, 0, 0, 0.1)",border:"1px solid rgba(255, 0, 0, 0.3)",borderRadius:"3px",after:{contentText:" \u26A0 Documentation may be stale (critical)",color:"rgba(255, 100, 100, 0.8)",fontStyle:"italic",margin:"0 0 0 1em"}})],["high",x.window.createTextEditorDecorationType({backgroundColor:"rgba(255, 165, 0, 0.1)",border:"1px solid rgba(255, 165, 0, 0.3)",borderRadius:"3px",after:{contentText:" \u26A0 Documentation may be stale",color:"rgba(255, 180, 100, 0.8)",fontStyle:"italic",margin:"0 0 0 1em"}})],["medium",x.window.createTextEditorDecorationType({backgroundColor:"rgba(255, 255, 0, 0.05)",border:"1px solid rgba(255, 255, 0, 0.2)",borderRadius:"3px",after:{contentText:" \u25CB Review documentation",color:"rgba(200, 200, 100, 0.7)",fontStyle:"italic",margin:"0 0 0 1em"}})],["low",x.window.createTextEditorDecorationType({after:{contentText:" \xB7 Minor drift detected",color:"rgba(150, 150, 150, 0.5)",fontStyle:"italic",margin:"0 0 0 1em"}})]])}applyDecorations(e,t,s){this.clearDecorations(e);let r=[],i=new Map([["critical",[]],["high",[]],["medium",[]],["low",[]]]);for(let o of t){if(o.driftScore<s.threshold||o.isReviewed)continue;let a=this.getSeverityFromScore(o.driftScore),c=this.createHoverMessage(o);if(s.enableGutter&&r.push({range:new x.Range(o.docRange.start,o.docRange.start),hoverMessage:c}),s.enableInline){let d=i.get(a);d&&d.push({range:new x.Range(o.docRange.start,new x.Position(o.docRange.start.line,o.docRange.start.character+3)),hoverMessage:c})}}if(s.enableGutter&&r.length>0&&(e.setDecorations(this.gutterDecorationType,r),this.trackDecoration(e.document.uri.toString(),this.gutterDecorationType)),s.enableInline){for(let[o,a]of i)if(a.length>0){let c=this.inlineDecorationTypes.get(o);c&&(e.setDecorations(c,a),this.trackDecoration(e.document.uri.toString(),c))}}}clearDecorations(e){let t=e.document.uri.toString(),s=this.activeDecorations.get(t);if(s){for(let r of s)e.setDecorations(r,[]);this.activeDecorations.delete(t)}}clearAllDecorations(){for(let e of x.window.visibleTextEditors)this.clearDecorations(e);this.activeDecorations.clear()}trackDecoration(e,t){let s=this.activeDecorations.get(e)||[];s.includes(t)||s.push(t),this.activeDecorations.set(e,s)}getSeverityFromScore(e){return e>=.8?"critical":e>=.6?"high":e>=.4?"medium":"low"}createHoverMessage(e){let t=new x.MarkdownString;t.isTrusted=!0;let s=this.getSeverityFromScore(e.driftScore),r=this.getSeverityIcon(s);if(t.appendMarkdown(`## ${r} Documentation Drift Detected

`),t.appendMarkdown(`**Drift Score:** ${Math.round(e.driftScore*100)}%

`),t.appendMarkdown(`**Function:** \`${e.codeSignature.name}\`

`),e.driftReasons.length>0){t.appendMarkdown(`### Issues Found:

`);for(let i of e.driftReasons){let o=this.getSeverityIcon(i.severity);t.appendMarkdown(`${o} **${i.message}**
`),i.details&&t.appendMarkdown(`  - ${i.details}
`),t.appendMarkdown(`
`)}}return t.appendMarkdown(`---

`),t.appendMarkdown(`[Mark as Reviewed](command:drift.markAsReviewed?${encodeURIComponent(JSON.stringify({id:e.id}))})`),t.appendMarkdown(" | "),t.appendMarkdown(`[Go to Code](command:drift.goToCode?${encodeURIComponent(JSON.stringify({line:e.codeRange.start.line}))})`),t}getSeverityIcon(e){switch(e){case"critical":return"\u{1F534}";case"high":return"\u{1F7E0}";case"medium":return"\u{1F7E1}";case"low":return"\u26AA";default:return"\u2753"}}getIconPath(e){return x.Uri.parse(`data:image/svg+xml,${encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                <circle cx="8" cy="8" r="6" fill="orange" opacity="0.8"/>
                <text x="8" y="11" text-anchor="middle" fill="white" font-size="10" font-weight="bold">!</text>
            </svg>`)}`)}dispose(){this.gutterDecorationType.dispose();for(let e of this.inlineDecorationTypes.values())e.dispose()}};var O=T(require("vscode")),de=class{_onDidChangeCodeLenses=new O.EventEmitter;onDidChangeCodeLenses=this._onDidChangeCodeLenses.event;pairs=new Map;stateManager;constructor(e){this.stateManager=e}updatePairs(e,t){this.pairs.set(e,t),this._onDidChangeCodeLenses.fire()}clearPairs(e){this.pairs.delete(e),this._onDidChangeCodeLenses.fire()}refresh(){this._onDidChangeCodeLenses.fire()}provideCodeLenses(e,t){let s=this.pairs.get(e.uri.toString());if(!s)return[];let r=[];for(let i of s){let o=this.stateManager.getTrackingStatus(i),a=new O.Range(i.docRange.start.line,0,i.docRange.start.line,0);o==="untracked"?r.push(new O.CodeLens(a,{title:"$(eye) Track Drift",tooltip:"Start tracking this documentation for drift",command:"drift.trackPair",arguments:[i]})):o==="drifted"||i.driftScore>0?(r.push(new O.CodeLens(a,{title:"$(sync) Review & Sync",tooltip:"Mark documentation as reviewed and sync with current code",command:"drift.reviewAndSync",arguments:[i]})),i.driftScore>0&&r.push(new O.CodeLens(a,{title:`$(warning) ${Math.round(i.driftScore*100)}% drift detected`,tooltip:i.driftReasons.map(c=>c.message).join(`
`),command:"drift.showDriftDetails",arguments:[i]}))):o==="synced"&&r.push(new O.CodeLens(a,{title:"$(check) Synced",tooltip:"Documentation is in sync with code",command:""}))}return r}resolveCodeLens(e,t){return e}};var ue=T(require("vscode")),L=T(require("fs")),V=T(require("path"));var Pe="1.0.0",is=".drift",ns="state.json",le=class{state;stateFilePath=null;isDirty=!1;constructor(){this.state={version:Pe,pairs:new Map}}async initialize(){let e=ue.workspace.workspaceFolders;if(!e||e.length===0)return;let t=e[0].uri.fsPath,s=V.join(t,is);this.stateFilePath=V.join(s,ns),await this.loadState()}async loadState(){if(this.stateFilePath)try{if(L.existsSync(this.stateFilePath)){let e=L.readFileSync(this.stateFilePath,"utf-8"),t=JSON.parse(e);this.state={version:t.version||Pe,pairs:new Map(Object.entries(t.pairs||{})),lastFullScan:t.lastFullScan?new Date(t.lastFullScan):void 0}}}catch(e){S.error("Error loading drift state:",e),this.state={version:Pe,pairs:new Map}}}async saveState(){if(this.stateFilePath)try{let e=V.dirname(this.stateFilePath);if(!L.existsSync(e)){L.mkdirSync(e,{recursive:!0});let s=V.join(e,".gitignore");L.existsSync(s)||L.writeFileSync(s,`# Uncomment the line below to ignore drift state
# state.json
`)}let t={version:this.state.version,pairs:Object.fromEntries(this.state.pairs),lastFullScan:this.state.lastFullScan?.toISOString()};L.writeFileSync(this.stateFilePath,JSON.stringify(t,null,2)),this.isDirty=!1}catch(e){S.error("Error saving drift state:",e),ue.window.showErrorMessage("Failed to save drift state")}}getPairState(e){return this.state.pairs.get(e)}updatePairState(e){let t={id:e.id,filePath:e.filePath,codeHash:e.codeSignature.hash,docHash:W(e.docContent),isReviewed:e.isReviewed,reviewedAt:e.reviewedAt,driftScore:e.driftScore};this.state.pairs.set(e.id,t),this.isDirty=!0}markAsReviewed(e){e.isReviewed=!0,e.reviewedAt=new Date,this.updatePairState(e)}hasCodeChanged(e){let t=this.state.pairs.get(e.id);return t?t.codeHash!==e.codeSignature.hash:!1}isTracked(e){return this.state.pairs.has(e)}getTrackingStatus(e){let t=this.state.pairs.get(e.id);return t?t.codeHash===e.codeSignature.hash?"synced":"drifted":"untracked"}removePairState(e){this.state.pairs.delete(e),this.isDirty=!0}clearAllState(){this.state.pairs.clear(),this.isDirty=!0}setLastFullScan(e){this.state.lastFullScan=e,this.isDirty=!0}getLastFullScan(){return this.state.lastFullScan}hasPendingChanges(){return this.isDirty}getAllTrackedPairs(){return Array.from(this.state.pairs.values())}getStatistics(){let e=0,t=0;for(let s of this.state.pairs.values())s.isReviewed?e++:t++;return{tracked:this.state.pairs.size,synced:e,drifted:t}}};var C,A,pe,R,M;async function os(n){S.initialize("Drift"),S.log("Drift extension activated");let e=fe();M=new le,await M.initialize(),C=new ne(e),A=new ae,pe=new ce,R=new de(M);let t=f.window.createTreeView("driftDashboard",{treeDataProvider:A,showCollapseAll:!0}),s=f.languages.registerCodeLensProvider([{language:"typescript"},{language:"javascript"},{language:"typescriptreact"},{language:"javascriptreact"},{language:"python"}],R);as(n),cs(n,e),n.subscriptions.push(t,s,{dispose:()=>pe.dispose()}),await ds(),hs(n),S.log("Drift extension ready")}function fe(){let n=f.workspace.getConfiguration("drift");return{enableGutterIcons:n.get("enableGutterIcons",!0),enableInlineDecorations:n.get("enableInlineDecorations",!0),excludePatterns:n.get("excludePatterns",["**/node_modules/**","**/dist/**","**/build/**","**/.git/**"]),supportedLanguages:n.get("supportedLanguages",["javascript","typescript","javascriptreact","typescriptreact","python"]),driftThreshold:n.get("driftThreshold",.3)}}function as(n){n.subscriptions.push(f.commands.registerCommand("drift.scanWorkspace",async()=>{await f.window.withProgress({location:f.ProgressLocation.Notification,title:"Drift: Scanning workspace...",cancellable:!1},async e=>{let t=await C.scanWorkspace(e);A.updatePairs(t),he(),ls(),M.setLastFullScan(new Date),await M.saveState();let s=A.getStatistics();f.window.showInformationMessage(`Drift scan complete: ${s.total} potential issues found (${s.critical} critical, ${s.high} high, ${s.medium} medium, ${s.low} low)`),f.window.showInformationMessage(`Drift scan complete: ${s.total} potential issues found (${s.critical} critical, ${s.high} high, ${s.medium} medium, ${s.low} low)`),S.log(`Scan complete: ${t.length} doc-code pairs analyzed`)})})),n.subscriptions.push(f.commands.registerCommand("drift.scanCurrentFile",async()=>{let e=f.window.activeTextEditor;if(!e){f.window.showWarningMessage("No active editor");return}let t=await C.scanDocument(e.document),s=C.getAllResults();A.updatePairs(s),G(e,t),R.updatePairs(e.document.uri.toString(),t);let r=t.filter(i=>i.driftScore>=fe().driftThreshold);r.length>0?f.window.showInformationMessage(`Drift: Found ${r.length} potential documentation issues in this file`):f.window.showInformationMessage("Drift: No documentation issues found in this file")})),n.subscriptions.push(f.commands.registerCommand("drift.markAsReviewed",async e=>{let t=e?.id;if(!t){let s=f.window.activeTextEditor;if(s){let r=C.getResultsForFile(s.document.uri.fsPath);if(r){let i=s.selection.active.line,o=r.find(a=>a.docRange.start.line<=i&&a.codeRange.end.line>=i);o&&(t=o.id)}}}if(t){A.markAsReviewed(t);let s=A.getPairById(t);s&&(M.markAsReviewed(s),await M.saveState()),he(),R.refresh(),f.window.showInformationMessage("Documentation marked as reviewed")}})),n.subscriptions.push(f.commands.registerCommand("drift.trackPair",async e=>{M.updatePairState(e),await M.saveState(),R.refresh(),f.window.showInformationMessage(`Now tracking drift for "${e.codeSignature.name}"`)})),n.subscriptions.push(f.commands.registerCommand("drift.reviewAndSync",async e=>{M.markAsReviewed(e),await M.saveState(),A.markAsReviewed(e.id),he(),R.refresh(),f.window.showInformationMessage(`Documentation for "${e.codeSignature.name}" marked as synced`)})),n.subscriptions.push(f.commands.registerCommand("drift.showDriftDetails",async e=>{let t=e.driftReasons.map(r=>({label:`$(warning) ${r.message}`,description:r.details,detail:`Severity: ${r.severity}`})),s=await f.window.showQuickPick(t,{title:`Drift Details for ${e.codeSignature.name}`,placeHolder:"Select an issue to see details"})})),n.subscriptions.push(f.commands.registerCommand("drift.showDashboard",()=>{f.commands.executeCommand("driftDashboard.focus")})),n.subscriptions.push(f.commands.registerCommand("drift.refreshDashboard",async()=>{await f.commands.executeCommand("drift.scanWorkspace")})),n.subscriptions.push(f.commands.registerCommand("drift.goToCode",async e=>{let t=f.window.activeTextEditor;if(t&&e?.line!==void 0){let s=new f.Position(e.line,0);t.selection=new f.Selection(s,s),t.revealRange(new f.Range(s,s),f.TextEditorRevealType.InCenter)}}))}function cs(n,e){let t=Ie(async s=>{let r=await C.scanDocument(s),i=C.getAllResults();A.updatePairs(i);let o=f.window.visibleTextEditors.find(a=>a.document.uri.toString()===s.uri.toString());o&&(G(o,r),R.updatePairs(s.uri.toString(),r))},1e3);n.subscriptions.push(f.workspace.onDidChangeTextDocument(s=>{s.contentChanges.length>0&&t(s.document)})),n.subscriptions.push(f.workspace.onDidOpenTextDocument(async s=>{let r=await C.scanDocument(s),i=f.window.visibleTextEditors.find(o=>o.document.uri.toString()===s.uri.toString());i&&(G(i,r),R.updatePairs(s.uri.toString(),r))})),n.subscriptions.push(f.window.onDidChangeActiveTextEditor(async s=>{if(s){let r=C.getResultsForFile(s.document.uri.fsPath);r||(r=await C.scanDocument(s.document)),G(s,r),R.updatePairs(s.document.uri.toString(),r)}})),n.subscriptions.push(f.workspace.onDidChangeConfiguration(s=>{if(s.affectsConfiguration("drift")){let r=fe();C.updateConfig(r),he(),R.refresh()}})),n.subscriptions.push(f.workspace.onDidSaveTextDocument(async s=>{let r=await C.scanDocument(s),i=C.getAllResults();A.updatePairs(i);let o=f.window.visibleTextEditors.find(a=>a.document.uri.toString()===s.uri.toString());o&&(G(o,r),R.updatePairs(s.uri.toString(),r))})),n.subscriptions.push(f.workspace.onDidCloseTextDocument(s=>{R.clearPairs(s.uri.toString())}))}async function ds(){for(let e of f.window.visibleTextEditors){let t=await C.scanDocument(e.document);G(e,t),R.updatePairs(e.document.uri.toString(),t)}let n=C.getAllResults();A.updatePairs(n)}function G(n,e){let t=fe();pe.applyDecorations(n,e,{enableGutter:t.enableGutterIcons,enableInline:t.enableInlineDecorations,threshold:t.driftThreshold})}function he(){for(let n of f.window.visibleTextEditors){let e=C.getResultsForFile(n.document.uri.fsPath)||[];G(n,e)}}function ls(){for(let n of f.window.visibleTextEditors){let e=C.getResultsForFile(n.document.uri.fsPath)||[];R.updatePairs(n.document.uri.toString(),e)}}async function us(){M?.hasPendingChanges()&&await M.saveState(),pe?.clearAllDecorations(),S.log("Drift extension deactivated"),S.dispose()}async function hs(n){f.env.isTelemetryEnabled&&S.log("Telemetry: Activation ping sent (simulated)")}0&&(module.exports={activate,deactivate});
